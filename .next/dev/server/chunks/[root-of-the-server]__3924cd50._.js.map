{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/models/User.ts"],"sourcesContent":["import mongoose, { Document, Schema } from \"mongoose\";\nimport bcrypt from \"bcryptjs\";\nimport connectDB from \"@/lib/db\";\n\nexport interface IUser extends Document {\n  _id: mongoose.Types.ObjectId;\n  firstName: string;\n  lastName: string;\n  email: string;\n  password: string;\n  phone?: string;\n  address?: string;\n  avatar?: string;\n  role: \"user\" | \"admin\" | \"vet\";\n  isVerified: boolean;\n  otp?: string;\n  otpExpires?: Date;\n  resetPasswordToken?: string;\n  resetPasswordExpires?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n  comparePassword(candidatePassword: string): Promise<boolean>;\n}\n\nconst UserSchema = new Schema<IUser>(\n  {\n    firstName: { type: String, required: true, trim: true, maxlength: 50 },\n    lastName: { type: String, required: true, trim: true, maxlength: 50 },\n    email: {\n      type: String,\n      required: true,\n      unique: true,\n      lowercase: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        \"Email invalide\",\n      ],\n    },\n    password: { type: String, required: true, minlength: 6, select: false },\n    phone: { type: String, maxlength: 20 },\n    address: { type: String, maxlength: 200 },\n    avatar: { type: String },\n    role: { type: String, enum: [\"user\", \"admin\", \"vet\"], default: \"user\" },\n    isVerified: { type: Boolean, default: false },\n    otp: { type: String, select: false },\n    otpExpires: { type: Date, select: false },\n    resetPasswordToken: { type: String, select: false },\n    resetPasswordExpires: { type: Date, select: false },\n  },\n  { timestamps: true }\n);\n\n// Hash password before saving\nUserSchema.pre(\"save\", async function (next) {\n  if (!this.isModified(\"password\")) return next();\n  const salt = await bcrypt.genSalt(10);\n  this.password = await bcrypt.hash(this.password, salt);\n  next();\n});\n\n// Compare passwords\nUserSchema.methods.comparePassword = async function (\n  candidatePassword: string\n): Promise<boolean> {\n  return bcrypt.compare(candidatePassword, this.password);\n};\n\nconst User: mongoose.Model<IUser> =\n  mongoose.models.User || mongoose.model<IUser>(\"User\", UserSchema);\n\nexport default User;\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAuBA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,MAAM;QAAM,WAAW;IAAG;IACrE,UAAU;QAAE,MAAM;QAAQ,UAAU;QAAM,MAAM;QAAM,WAAW;IAAG;IACpE,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,OAAO;YACL;YACA;SACD;IACH;IACA,UAAU;QAAE,MAAM;QAAQ,UAAU;QAAM,WAAW;QAAG,QAAQ;IAAM;IACtE,OAAO;QAAE,MAAM;QAAQ,WAAW;IAAG;IACrC,SAAS;QAAE,MAAM;QAAQ,WAAW;IAAI;IACxC,QAAQ;QAAE,MAAM;IAAO;IACvB,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAQ;YAAS;SAAM;QAAE,SAAS;IAAO;IACtE,YAAY;QAAE,MAAM;QAAS,SAAS;IAAM;IAC5C,KAAK;QAAE,MAAM;QAAQ,QAAQ;IAAM;IACnC,YAAY;QAAE,MAAM;QAAM,QAAQ;IAAM;IACxC,oBAAoB;QAAE,MAAM;QAAQ,QAAQ;IAAM;IAClD,sBAAsB;QAAE,MAAM;QAAM,QAAQ;IAAM;AACpD,GACA;IAAE,YAAY;AAAK;AAGrB,8BAA8B;AAC9B,WAAW,GAAG,CAAC,QAAQ,eAAgB,IAAI;IACzC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO;IACzC,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;IAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,8IAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;IACjD;AACF;AAEA,oBAAoB;AACpB,WAAW,OAAO,CAAC,eAAe,GAAG,eACnC,iBAAyB;IAEzB,OAAO,8IAAM,CAAC,OAAO,CAAC,mBAAmB,IAAI,CAAC,QAAQ;AACxD;AAEA,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEzC","debugId":null}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/app/api/auth/login/route.ts"],"sourcesContent":["import { UserService } from \"@/models/User\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport jwt from \"jsonwebtoken\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { email, password } = body;\n\n    if (!email || !password) {\n      return NextResponse.json(\n        { error: \"Email et mot de passe sont requis\" },\n        { status: 400 }\n      );\n    }\n\n    const user = await UserService.login({ email, password });\n\n    if (!user) {\n      return NextResponse.json(\n        { error: \"Email ou mot de passe incorrect\" },\n        { status: 401 }\n      );\n    }\n\n    \n    const token = jwt.sign(\n      { id: user._id, email: user.email, role: user.role },\n      process.env.JWT_SECRET!,\n      { expiresIn: \"7d\" }\n    );\n\n    return NextResponse.json(\n      { message: \"Connexion r√©ussie\", user, token },\n      { status: 200 }\n    );\n  } catch (error: any) {\n    console.error(\"Erreur login:\", error);\n    return NextResponse.json(\n      { error: error.message || \"Erreur serveur\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,+HAAW,CAAC,KAAK,CAAC;YAAE;YAAO;QAAS;QAEvD,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAGA,MAAM,QAAQ,kJAAG,CAAC,IAAI,CACpB;YAAE,IAAI,KAAK,GAAG;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC,GACnD,QAAQ,GAAG,CAAC,UAAU,EACtB;YAAE,WAAW;QAAK;QAGpB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAqB;YAAM;QAAM,GAC5C;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAiB,GAC3C;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}