{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/lib/db.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI =\n  process.env.MONGODB_URI || \"mongodb://localhost:27017/petconnect\";\n\nif (!MONGODB_URI) {\n  throw new Error(\n    \"Please define the MONGODB_URI environment variable inside .env.local\"\n  );\n}\n\nlet cached = (global as any).mongoose;\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null };\n}\n\nasync function connectDB() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log(\"Connexion à la base de données réussie\");\n      return mongoose;\n    });\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cACJ,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE7B;;AAMA,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IACA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QACA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/models/WeightLog.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\n\nexport interface IWeightLog extends Document {\n  petId: mongoose.Types.ObjectId;\n  weight: number;\n  date: Date;\n}\n\nconst WeightLogSchema = new Schema<IWeightLog>({\n  petId: { type: Schema.Types.ObjectId, ref: \"Pet\", required: true },\n  weight: { type: Number, required: true },\n  date: { type: Date, default: Date.now },\n});\n\nexport default mongoose.models.WeightLog ||\n  mongoose.model<IWeightLog>(\"WeightLog\", WeightLogSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAQA,MAAM,kBAAkB,IAAI,mHAAM,CAAa;IAC7C,OAAO;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAO,UAAU;IAAK;IACjE,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,MAAM;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AACxC;uCAEe,oHAAQ,CAAC,MAAM,CAAC,SAAS,IACtC,oHAAQ,CAAC,KAAK,CAAa,aAAa","debugId":null}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/app/api/pets/%5Bid%5D/weights/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport connectDB from \"@/lib/db\";\nimport jwt from \"jsonwebtoken\";\nimport WeightLog from \"@/models/WeightLog\";\n\nfunction verifyToken(request: NextRequest) {\n  const authHeader = request.headers.get(\"authorization\");\n  if (!authHeader) return null;\n  const token = authHeader.split(\" \")[1];\n  if (!token) return null;\n  try {\n    return jwt.verify(token, process.env.JWT_SECRET!);\n  } catch {\n    return null;\n  }\n}\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  await connectDB();\n  const decoded: any = verifyToken(request);\n  if (!decoded)\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  const { id } = await params; // ✅ await params\n\n  try {\n    const weights = await WeightLog.find({ petId: id }).sort({ date: 1 });\n    return NextResponse.json({ weights });\n  } catch (err: any) {\n    return NextResponse.json({ error: err.message }, { status: 500 });\n  }\n}\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  await connectDB();\n  const decoded: any = verifyToken(request);\n  if (!decoded)\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  const { id } = await params;\n  try {\n    const { weight } = await request.json();\n    if (!weight)\n      return NextResponse.json({ error: \"Weight required\" }, { status: 400 });\n\n    const newLog = new WeightLog({ petId: id, weight, date: new Date() });\n    await newLog.save();\n\n    return NextResponse.json({ weightLog: newLog }, { status: 201 });\n  } catch (err: any) {\n    return NextResponse.json({ error: err.message }, { status: 500 });\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  await connectDB();\n  const decoded: any = verifyToken(request);\n  if (!decoded)\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\n  try {\n    const { weightId } = await request.json();\n    if (!weightId)\n      return NextResponse.json(\n        { error: \"Weight ID required\" },\n        { status: 400 }\n      );\n\n    const deleted = await WeightLog.findByIdAndDelete(weightId);\n    if (!deleted)\n      return NextResponse.json({ error: \"Weight not found\" }, { status: 404 });\n\n    return NextResponse.json({\n      message: \"Weight deleted successfully\",\n      weight: deleted,\n    });\n  } catch (err: any) {\n    return NextResponse.json({ error: err.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,SAAS,YAAY,OAAoB;IACvC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,IAAI,CAAC,YAAY,OAAO;IACxB,MAAM,QAAQ,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;IACtC,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACjD,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,MAAM,IAAA,sHAAS;IACf,MAAM,UAAe,YAAY;IACjC,IAAI,CAAC,SACH,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IACpE,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,QAAQ,iBAAiB;IAE9C,IAAI;QACF,MAAM,UAAU,MAAM,gIAAS,CAAC,IAAI,CAAC;YAAE,OAAO;QAAG,GAAG,IAAI,CAAC;YAAE,MAAM;QAAE;QACnE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACrC,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF;AAEO,eAAe,KACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,MAAM,IAAA,sHAAS;IACf,MAAM,UAAe,YAAY;IACjC,IAAI,CAAC,SACH,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IACpE,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QACrC,IAAI,CAAC,QACH,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;QAEvE,MAAM,SAAS,IAAI,gIAAS,CAAC;YAAE,OAAO;YAAI;YAAQ,MAAM,IAAI;QAAO;QACnE,MAAM,OAAO,IAAI;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,WAAW;QAAO,GAAG;YAAE,QAAQ;QAAI;IAChE,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF;AAEO,eAAe,OACpB,OAAoB,EACpB,EAAE,MAAM,EAA8B;IAEtC,MAAM,IAAA,sHAAS;IACf,MAAM,UAAe,YAAY;IACjC,IAAI,CAAC,SACH,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IAEpE,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QACvC,IAAI,CAAC,UACH,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAqB,GAC9B;YAAE,QAAQ;QAAI;QAGlB,MAAM,UAAU,MAAM,gIAAS,CAAC,iBAAiB,CAAC;QAClD,IAAI,CAAC,SACH,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmB,GAAG;YAAE,QAAQ;QAAI;QAExE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,QAAQ;QACV;IACF,EAAE,OAAO,KAAU;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF","debugId":null}}]
}