{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/models/TrainingSession.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\n\n// Interface pour une leçon individuelle\nexport interface ILesson {\n  id: string;\n  title: string;\n  description: string;\n  duration: number; // en minutes\n  difficulty: \"beginner\" | \"intermediate\" | \"advanced\";\n  instructions: string[];\n  tips: string[];\n  completed: boolean;\n  completedAt?: Date;\n  score?: number; // 0-100\n}\n\n// Interface pour un programme d'entraînement\nexport interface ITrainingProgram {\n  id: string;\n  name: string;\n  category:\n    | \"obedience\"\n    | \"leash\"\n    | \"tricks\"\n    | \"socialization\"\n    | \"housetraining\";\n  description: string;\n  icon: string;\n  totalLessons: number;\n  completedLessons: number;\n  progress: number; // 0-100\n  lessons: ILesson[];\n  estimatedWeeks: number;\n  difficulty: \"beginner\" | \"intermediate\" | \"advanced\";\n}\n\n// Interface pour une session d'entraînement\nexport interface ITrainingSession extends Document {\n  userId: mongoose.Types.ObjectId;\n  petId: mongoose.Types.ObjectId;\n  programId: string;\n  lessonId: string;\n  startedAt: Date;\n  completedAt?: Date;\n  duration: number; // durée réelle en minutes\n  score?: number; // 0-100\n  notes?: string;\n  difficulty: \"easy\" | \"medium\" | \"hard\";\n  nextSessionDate?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n// Interface pour les statistiques de progression\nexport interface IProgressStats {\n  petId: string;\n  programs: {\n    [programId: string]: {\n      progress: number;\n      completedLessons: number;\n      totalLessons: number;\n      lastSessionDate?: Date;\n      averageScore?: number;\n    };\n  };\n  totalSessionsCompleted: number;\n  totalTrainingTime: number; // en minutes\n  currentStreak: number; // jours consécutifs\n  longestStreak: number;\n  lastSessionDate?: Date;\n}\n\n// Schéma MongoDB pour les sessions d'entraînement\nconst TrainingSessionSchema = new Schema<ITrainingSession>(\n  {\n    userId: { type: Schema.Types.ObjectId, ref: \"User\", required: true },\n    petId: { type: Schema.Types.ObjectId, ref: \"Pet\", required: true },\n    programId: { type: String, required: true },\n    lessonId: { type: String, required: true },\n    startedAt: { type: Date, required: true },\n    completedAt: { type: Date },\n    duration: { type: Number, required: true },\n    score: { type: Number, min: 0, max: 100 },\n    notes: { type: String },\n    difficulty: {\n      type: String,\n      enum: [\"easy\", \"medium\", \"hard\"],\n      required: true,\n    },\n    nextSessionDate: { type: Date },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Index pour optimiser les requêtes\nTrainingSessionSchema.index({ userId: 1, petId: 1 });\nTrainingSessionSchema.index({ programId: 1, lessonId: 1 });\nTrainingSessionSchema.index({ startedAt: -1 });\n\nexport default mongoose.models.TrainingSession ||\n  mongoose.model<ITrainingSession>(\"TrainingSession\", TrainingSessionSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAwEA,kDAAkD;AAClD,MAAM,wBAAwB,IAAI,mHAAM,CACtC;IACE,QAAQ;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IACnE,OAAO;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAO,UAAU;IAAK;IACjE,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,WAAW;QAAE,MAAM;QAAM,UAAU;IAAK;IACxC,aAAa;QAAE,MAAM;IAAK;IAC1B,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,OAAO;QAAE,MAAM;QAAQ,KAAK;QAAG,KAAK;IAAI;IACxC,OAAO;QAAE,MAAM;IAAO;IACtB,YAAY;QACV,MAAM;QACN,MAAM;YAAC;YAAQ;YAAU;SAAO;QAChC,UAAU;IACZ;IACA,iBAAiB;QAAE,MAAM;IAAK;AAChC,GACA;IACE,YAAY;AACd;AAGF,oCAAoC;AACpC,sBAAsB,KAAK,CAAC;IAAE,QAAQ;IAAG,OAAO;AAAE;AAClD,sBAAsB,KAAK,CAAC;IAAE,WAAW;IAAG,UAAU;AAAE;AACxD,sBAAsB,KAAK,CAAC;IAAE,WAAW,CAAC;AAAE;uCAE7B,oHAAQ,CAAC,MAAM,CAAC,eAAe,IAC5C,oHAAQ,CAAC,KAAK,CAAmB,mBAAmB","debugId":null}},
    {"offset": {"line": 129, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/services/education.ts"],"sourcesContent":["import {\n  ITrainingProgram,\n  ILesson,\n  IProgressStats,\n} from \"../models/TrainingSession\";\n\n// Programmes d'entraînement prédéfinis\nexport const TRAINING_PROGRAMS: ITrainingProgram[] = [\n  {\n    id: \"obedience-basic\",\n    name: \"Obéissance de base\",\n    category: \"obedience\",\n    description: \"Commandes essentielles : assis, couché, reste, viens\",\n    icon: \"GraduationCap\",\n    totalLessons: 8,\n    completedLessons: 0,\n    progress: 0,\n    estimatedWeeks: 4,\n    difficulty: \"beginner\",\n    lessons: [\n      {\n        id: \"obedience-1\",\n        title: 'Commande \"Assis\"',\n        description: 'Apprendre la commande de base \"assis\"',\n        duration: 15,\n        difficulty: \"beginner\",\n        instructions: [\n          \"Tenez une friandise au-dessus de la tête de votre chien\",\n          'Dites \"Assis\" d\\'une voix claire et ferme',\n          \"Levez lentement la friandise vers l'arrière\",\n          \"Dès qu'il s'assoit, récompensez et félicitez\",\n          \"Répétez 10-15 fois par session\",\n        ],\n        tips: [\n          \"Soyez patient et constant\",\n          \"Utilisez des friandises de haute valeur\",\n          \"Pratiquez avant les repas quand il a faim\",\n        ],\n        completed: false,\n      },\n      {\n        id: \"obedience-2\",\n        title: 'Commande \"Couché\"',\n        description: \"Enseigner la position couchée\",\n        duration: 20,\n        difficulty: \"beginner\",\n        instructions: [\n          \"Commencez avec votre chien en position assise\",\n          \"Tenez une friandise devant son nez\",\n          \"Abaissez lentement la friandise vers le sol\",\n          'Dites \"Couché\" quand il commence à se baisser',\n        ],\n        tips: [\n          \"Ne forcez jamais physiquement\",\n          \"Utilisez le leurre de la friandise\",\n        ],\n        completed: false,\n      },\n    ],\n  },\n  {\n    id: \"leash-training\",\n    name: \"Marche en laisse\",\n    category: \"leash\",\n    description: \"Techniques pour une marche sans tirer et avec attention\",\n    icon: \"BookOpen\",\n    totalLessons: 5,\n    completedLessons: 0,\n    progress: 0,\n    estimatedWeeks: 3,\n    difficulty: \"intermediate\",\n    lessons: [\n      {\n        id: \"leash-1\",\n        title: \"Habituation à la laisse\",\n        description: \"Familiariser votre chien avec le collier et la laisse\",\n        duration: 15,\n        difficulty: \"beginner\",\n        instructions: [\n          \"Laissez votre chien sentir et explorer la laisse\",\n          \"Attachez la laisse sans tension\",\n          \"Récompensez le comportement calme\",\n        ],\n        tips: [\n          \"Associez la laisse à des expériences positives\",\n          \"Ne tirez jamais sur la laisse\",\n        ],\n        completed: false,\n      },\n    ],\n  },\n  {\n    id: \"advanced-tricks\",\n    name: \"Tricks avancés\",\n    category: \"tricks\",\n    description: \"Tours et astuces pour stimuler mentalement votre animal\",\n    icon: \"Trophy\",\n    totalLessons: 6,\n    completedLessons: 0,\n    progress: 0,\n    estimatedWeeks: 6,\n    difficulty: \"advanced\",\n    lessons: [\n      {\n        id: \"tricks-1\",\n        title: \"Faire le beau\",\n        description: \"Apprendre à se dresser sur les pattes arrière\",\n        duration: 20,\n        difficulty: \"intermediate\",\n        instructions: [\n          \"Commencez avec votre chien en position assise\",\n          \"Tenez une friandise au-dessus de sa tête\",\n          \"Levez lentement la friandise vers le haut\",\n        ],\n        tips: [\n          'Assurez-vous que votre chien maîtrise \"assis\"',\n          \"Commencez par de courtes durées\",\n        ],\n        completed: false,\n      },\n    ],\n  },\n  {\n    id: \"socialization\",\n    name: \"Socialisation\",\n    category: \"socialization\",\n    description: \"Développer les compétences sociales\",\n    icon: \"Users\",\n    totalLessons: 4,\n    completedLessons: 0,\n    progress: 0,\n    estimatedWeeks: 8,\n    difficulty: \"intermediate\",\n    lessons: [\n      {\n        id: \"social-1\",\n        title: \"Rencontres contrôlées\",\n        description: \"Organiser des rencontres sécurisées\",\n        duration: 30,\n        difficulty: \"intermediate\",\n        instructions: [\n          \"Choisissez un chien calme et bien socialisé\",\n          \"Rencontrez-vous dans un terrain neutre\",\n        ],\n        tips: [\n          \"Commencez par de courtes rencontres\",\n          \"Restez calme et détendu\",\n        ],\n        completed: false,\n      },\n    ],\n  },\n];\n\n// Conseils comportementaux prédéfinis\nexport const BEHAVIORAL_TIPS = [\n  {\n    id: \"excessive-barking\",\n    title: \"Aboiements excessifs\",\n    description:\n      \"Les aboiements peuvent être causés par l'ennui ou l'anxiété. Essayez d'augmenter l'exercice quotidien et offrez des jouets d'enrichissement mental.\",\n    category: \"behavior\",\n    severity: \"medium\",\n    solutions: [\n      \"Augmentez l'exercice physique quotidien\",\n      \"Fournissez des jouets de stimulation mentale\",\n      \"Ignorez les aboiements d'attention\",\n      \"Récompensez le silence\",\n    ],\n  },\n  {\n    id: \"separation-anxiety\",\n    title: \"Anxiété de séparation\",\n    description:\n      \"Pratiquez des départs courts et progressifs. Ne faites pas de grands adieux ou retours émotionnels.\",\n    category: \"anxiety\",\n    severity: \"high\",\n    solutions: [\n      \"Pratiquez des départs très courts\",\n      \"Créez des associations positives avec la solitude\",\n      \"Laissez des jouets spéciaux pour l'absence\",\n      \"Consultez un vétérinaire si sévère\",\n    ],\n  },\n  {\n    id: \"object-chewing\",\n    title: \"Mâchonnement d'objets\",\n    description:\n      \"Fournissez des alternatives appropriées comme des jouets à mâcher.\",\n    category: \"behavior\",\n    severity: \"medium\",\n    solutions: [\n      \"Fournissez des jouets à mâcher appropriés\",\n      \"Rangez les objets tentants\",\n      \"Récompensez l'utilisation des bons jouets\",\n    ],\n  },\n];\n\n// Classe de service pour l'éducation\nexport class EducationService {\n  // Récupérer tous les programmes\n  static getAllPrograms(): ITrainingProgram[] {\n    return TRAINING_PROGRAMS;\n  }\n\n  // Récupérer un programme par ID\n  static getProgramById(programId: string): ITrainingProgram | undefined {\n    return TRAINING_PROGRAMS.find((program) => program.id === programId);\n  }\n\n  // Récupérer une leçon spécifique\n  static getLessonById(\n    programId: string,\n    lessonId: string\n  ): ILesson | undefined {\n    const program = this.getProgramById(programId);\n    return program?.lessons.find((lesson) => lesson.id === lessonId);\n  }\n\n  // Calculer les statistiques de progression\n  static calculateProgress(sessions: any[], programId: string): number {\n    const program = this.getProgramById(programId);\n    if (!program) return 0;\n\n    const completedLessons = new Set(\n      sessions\n        .filter((s) => s.programId === programId && s.completedAt)\n        .map((s) => s.lessonId)\n    ).size;\n\n    return Math.round((completedLessons / program.totalLessons) * 100);\n  }\n\n  // Générer des recommandations personnalisées\n  static getPersonalizedRecommendations(\n    petType: string,\n    age: number\n  ): string[] {\n    const recommendations = [];\n\n    if (age < 1) {\n      recommendations.push(\"Concentrez-vous sur la socialisation précoce\");\n      recommendations.push(\n        \"Commencez par des sessions très courtes (5-10 minutes)\"\n      );\n    } else if (age > 7) {\n      recommendations.push(\"Adaptez les exercices aux capacités physiques\");\n      recommendations.push(\"Privilégiez la stimulation mentale\");\n    }\n\n    if (petType.toLowerCase().includes(\"chien\")) {\n      recommendations.push(\"La marche en laisse est essentielle\");\n      recommendations.push(\"Travaillez le rappel dans des espaces sécurisés\");\n    }\n\n    return recommendations;\n  }\n\n  // Générer un planning d'entraînement\n  static generateTrainingSchedule(programs: string[]): any[] {\n    const schedule: any[] = [];\n    const days = [\"Lundi\", \"Mercredi\", \"Vendredi\"];\n\n    programs.forEach((programId, index) => {\n      const program = this.getProgramById(programId);\n      if (program && program.lessons.length > 0) {\n        const dayIndex = index % days.length;\n        schedule.push({\n          day: days[dayIndex],\n          programId,\n          programName: program.name,\n          lesson: program.lessons[0],\n          duration: program.lessons[0].duration,\n          status:\n            index === 1 ? \"Aujourd'hui\" : index === 0 ? \"Complété\" : \"À venir\",\n        });\n      }\n    });\n\n    return schedule;\n  }\n\n  // Obtenir les conseils comportementaux\n  static getBehavioralTips(): typeof BEHAVIORAL_TIPS {\n    return BEHAVIORAL_TIPS;\n  }\n\n  // Rechercher des conseils par catégorie\n  static getTipsByCategory(category: string): typeof BEHAVIORAL_TIPS {\n    return BEHAVIORAL_TIPS.filter((tip) => tip.category === category);\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 397, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/lib/db.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI =\n  process.env.MONGODB_URI || \"mongodb://localhost:27017/petconnect\";\n\nif (!MONGODB_URI) {\n  throw new Error(\n    \"Please define the MONGODB_URI environment variable inside .env.local\"\n  );\n}\n\nlet cached = (global as any).mongoose;\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null };\n}\n\nasync function connectDB() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log(\"Connexion à la base de données réussie\");\n      return mongoose;\n    });\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cACJ,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE7B;;AAMA,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IACA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QACA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 458, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/lib/auth.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\nimport jwt from \"jsonwebtoken\";\n\nconst JWT_SECRET =\n  process.env.JWT_SECRET ||\n  \"petconnect_super_secret_key_change_this_in_production_minimum_32_characters_random\";\n\ninterface AuthResult {\n  authenticated: boolean;\n  userId?: string;\n  email?: string;\n  role?: string;\n  error?: string;\n}\n\n/**\n * Authentifie l'utilisateur à partir du token JWT dans les headers\n */\nexport async function authenticateUser(\n  request: NextRequest\n): Promise<AuthResult> {\n  try {\n    // Récupérer le token depuis les headers\n    const authHeader = request.headers.get(\"Authorization\");\n\n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n      console.log(\"❌ Aucun token fourni\");\n      return {\n        authenticated: false,\n        error: \"Token manquant\",\n      };\n    }\n\n    // Extraire le token\n    const token = authHeader.substring(7); // Enlever \"Bearer \"\n\n    // Vérifier et décoder le token\n    const decoded = jwt.verify(token, JWT_SECRET) as {\n      userId?: string;\n      id?: string;\n      email?: string;\n      role?: string;\n    };\n\n    // Le token peut avoir soit 'userId' soit 'id'\n    const userId = decoded.userId || decoded.id;\n\n    if (!userId) {\n      console.log(\"❌ Token invalide: pas d'userId\");\n      return {\n        authenticated: false,\n        error: \"Token invalide\",\n      };\n    }\n\n    console.log(\"✅ Utilisateur authentifié:\", userId);\n\n    return {\n      authenticated: true,\n      userId,\n      email: decoded.email,\n      role: decoded.role,\n    };\n  } catch (error: any) {\n    console.error(\"❌ Erreur authentification:\", error.message);\n\n    if (error.name === \"TokenExpiredError\") {\n      return {\n        authenticated: false,\n        error: \"Token expiré\",\n      };\n    }\n\n    if (error.name === \"JsonWebTokenError\") {\n      return {\n        authenticated: false,\n        error: \"Token invalide\",\n      };\n    }\n\n    return {\n      authenticated: false,\n      error: \"Erreur d'authentification\",\n    };\n  }\n}\n\n/**\n * Extrait le token depuis les cookies (alternative)\n */\nexport function getTokenFromCookies(request: NextRequest): string | null {\n  const token = request.cookies.get(\"token\")?.value;\n  return token || null;\n}\n\n/**\n * Vérifie si l'utilisateur a un rôle spécifique\n */\nexport function hasRole(authResult: AuthResult, requiredRole: string): boolean {\n  return authResult.authenticated && authResult.role === requiredRole;\n}\n\n/**\n * Vérifie si l'utilisateur est admin\n */\nexport function isAdmin(authResult: AuthResult): boolean {\n  return hasRole(authResult, \"admin\");\n}\n\n/**\n * Vérifie si l'utilisateur est vétérinaire\n */\nexport function isVet(authResult: AuthResult): boolean {\n  return hasRole(authResult, \"vet\");\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AACA;;AAEA,MAAM,aACJ,QAAQ,GAAG,CAAC,UAAU,IACtB;AAaK,eAAe,iBACpB,OAAoB;IAEpB,IAAI;QACF,wCAAwC;QACxC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QAEvC,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;YACpD,QAAQ,GAAG,CAAC;YACZ,OAAO;gBACL,eAAe;gBACf,OAAO;YACT;QACF;QAEA,oBAAoB;QACpB,MAAM,QAAQ,WAAW,SAAS,CAAC,IAAI,oBAAoB;QAE3D,+BAA+B;QAC/B,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO;QAOlC,8CAA8C;QAC9C,MAAM,SAAS,QAAQ,MAAM,IAAI,QAAQ,EAAE;QAE3C,IAAI,CAAC,QAAQ;YACX,QAAQ,GAAG,CAAC;YACZ,OAAO;gBACL,eAAe;gBACf,OAAO;YACT;QACF;QAEA,QAAQ,GAAG,CAAC,8BAA8B;QAE1C,OAAO;YACL,eAAe;YACf;YACA,OAAO,QAAQ,KAAK;YACpB,MAAM,QAAQ,IAAI;QACpB;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,8BAA8B,MAAM,OAAO;QAEzD,IAAI,MAAM,IAAI,KAAK,qBAAqB;YACtC,OAAO;gBACL,eAAe;gBACf,OAAO;YACT;QACF;QAEA,IAAI,MAAM,IAAI,KAAK,qBAAqB;YACtC,OAAO;gBACL,eAAe;gBACf,OAAO;YACT;QACF;QAEA,OAAO;YACL,eAAe;YACf,OAAO;QACT;IACF;AACF;AAKO,SAAS,oBAAoB,OAAoB;IACtD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAC5C,OAAO,SAAS;AAClB;AAKO,SAAS,QAAQ,UAAsB,EAAE,YAAoB;IAClE,OAAO,WAAW,aAAa,IAAI,WAAW,IAAI,KAAK;AACzD;AAKO,SAAS,QAAQ,UAAsB;IAC5C,OAAO,QAAQ,YAAY;AAC7B;AAKO,SAAS,MAAM,UAAsB;IAC1C,OAAO,QAAQ,YAAY;AAC7B","debugId":null}},
    {"offset": {"line": 541, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/app/api/training/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport TrainingSession from \"../../../models/TrainingSession\";\nimport {\n  EducationService,\n  TRAINING_PROGRAMS,\n  BEHAVIORAL_TIPS,\n} from \"../../../services/education\";\nimport connectDB from \"@/lib/db\";\nimport { authenticateUser } from \"@/lib/auth\";\n\n// GET - Récupérer les programmes d'entraînement et les statistiques\nexport async function GET(request: NextRequest) {\n  try {\n    const authResult = await authenticateUser(request);\n    if (!authResult.authenticated) {\n      return NextResponse.json({ error: \"Non autorisé\" }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const petId = searchParams.get(\"petId\");\n    const type = searchParams.get(\"type\") || \"programs\";\n\n    await connectDB();\n\n    if (type === \"programs\") {\n      // Récupérer les programmes avec progression\n      let programsWithProgress = [...TRAINING_PROGRAMS];\n\n      if (petId) {\n        // Calculer la progression pour chaque programme\n        const sessions = await TrainingSession.find({\n          userId: authResult.userId,\n          petId: petId,\n        });\n\n        programsWithProgress = TRAINING_PROGRAMS.map((program) => {\n          const progress = EducationService.calculateProgress(\n            sessions,\n            program.id\n          );\n          const completedLessons = new Set(\n            sessions\n              .filter((s) => s.programId === program.id && s.completedAt)\n              .map((s) => s.lessonId)\n          ).size;\n\n          return {\n            ...program,\n            completedLessons,\n            progress,\n          };\n        });\n      }\n\n      return NextResponse.json({\n        programs: programsWithProgress,\n        tips: BEHAVIORAL_TIPS,\n      });\n    }\n\n    if (type === \"stats\" && petId) {\n      // Statistiques de progression\n      const sessions = await TrainingSession.find({\n        userId: authResult.userId,\n        petId: petId,\n      }).sort({ startedAt: -1 });\n\n      const stats = {\n        totalSessions: sessions.length,\n        totalTrainingTime: sessions.reduce((sum, s) => sum + s.duration, 0),\n        completedSessions: sessions.filter((s) => s.completedAt).length,\n        averageScore: sessions\n          .filter((s) => s.score)\n          .reduce((sum, s, _, arr) => {\n            return arr.length > 0 ? sum + (s.score || 0) / arr.length : 0;\n          }, 0),\n        lastSessionDate: sessions[0]?.startedAt,\n        programStats: TRAINING_PROGRAMS.map((program) => {\n          const progress = EducationService.calculateProgress(\n            sessions,\n            program.id\n          );\n          const programSessions = sessions.filter(\n            (s) => s.programId === program.id\n          );\n          const completedLessons = new Set(\n            programSessions.filter((s) => s.completedAt).map((s) => s.lessonId)\n          ).size;\n\n          return {\n            programId: program.id,\n            programName: program.name,\n            progress,\n            completedLessons,\n            totalLessons: program.totalLessons,\n            lastSession: programSessions[0]?.startedAt,\n          };\n        }),\n      };\n\n      return NextResponse.json({ stats });\n    }\n\n    if (type === \"schedule\") {\n      // Générer un planning d'entraînement\n      const activePrograms = [\n        \"obedience-basic\",\n        \"leash-training\",\n        \"socialization\",\n      ];\n      const schedule =\n        EducationService.generateTrainingSchedule(activePrograms);\n\n      return NextResponse.json({ schedule });\n    }\n\n    return NextResponse.json(\n      { error: \"Type de requête invalide\" },\n      { status: 400 }\n    );\n  } catch (error) {\n    console.error(\"Erreur API training:\", error);\n    return NextResponse.json({ error: \"Erreur serveur\" }, { status: 500 });\n  }\n}\n\n// POST - Créer une nouvelle session d'entraînement\nexport async function POST(request: NextRequest) {\n  try {\n    const authResult = await authenticateUser(request);\n    if (!authResult.authenticated) {\n      return NextResponse.json({ error: \"Non autorisé\" }, { status: 401 });\n    }\n\n    const body = await request.json();\n    const { petId, programId, lessonId, duration, score, notes, difficulty } =\n      body;\n\n    if (!petId || !programId || !lessonId || !duration) {\n      return NextResponse.json(\n        {\n          error:\n            \"Données manquantes: petId, programId, lessonId et duration sont requis\",\n        },\n        { status: 400 }\n      );\n    }\n\n    // Vérifier que le programme et la leçon existent\n    const lesson = EducationService.getLessonById(programId, lessonId);\n    if (!lesson) {\n      return NextResponse.json(\n        { error: \"Programme ou leçon introuvable\" },\n        { status: 404 }\n      );\n    }\n\n    await connectDB();\n\n    const session = new TrainingSession({\n      userId: authResult.userId,\n      petId,\n      programId,\n      lessonId,\n      startedAt: new Date(),\n      completedAt: new Date(), // Session terminée immédiatement\n      duration,\n      score: score || null,\n      notes: notes || \"\",\n      difficulty: difficulty || \"medium\",\n    });\n\n    await session.save();\n\n    return NextResponse.json({\n      message: \"Session enregistrée avec succès\",\n      session: {\n        id: session._id,\n        programId: session.programId,\n        lessonId: session.lessonId,\n        duration: session.duration,\n        score: session.score,\n        completedAt: session.completedAt,\n      },\n    });\n  } catch (error) {\n    console.error(\"Erreur création session:\", error);\n    return NextResponse.json({ error: \"Erreur serveur\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AAKA;AACA;;;;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,aAAa,MAAM,IAAA,iIAAgB,EAAC;QAC1C,IAAI,CAAC,WAAW,aAAa,EAAE;YAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QAEzC,MAAM,IAAA,sHAAS;QAEf,IAAI,SAAS,YAAY;YACvB,4CAA4C;YAC5C,IAAI,uBAAuB;mBAAI,4IAAiB;aAAC;YAEjD,IAAI,OAAO;gBACT,gDAAgD;gBAChD,MAAM,WAAW,MAAM,sIAAe,CAAC,IAAI,CAAC;oBAC1C,QAAQ,WAAW,MAAM;oBACzB,OAAO;gBACT;gBAEA,uBAAuB,4IAAiB,CAAC,GAAG,CAAC,CAAC;oBAC5C,MAAM,WAAW,2IAAgB,CAAC,iBAAiB,CACjD,UACA,QAAQ,EAAE;oBAEZ,MAAM,mBAAmB,IAAI,IAC3B,SACG,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,KAAK,QAAQ,EAAE,IAAI,EAAE,WAAW,EACzD,GAAG,CAAC,CAAC,IAAM,EAAE,QAAQ,GACxB,IAAI;oBAEN,OAAO;wBACL,GAAG,OAAO;wBACV;wBACA;oBACF;gBACF;YACF;YAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,UAAU;gBACV,MAAM,0IAAe;YACvB;QACF;QAEA,IAAI,SAAS,WAAW,OAAO;YAC7B,8BAA8B;YAC9B,MAAM,WAAW,MAAM,sIAAe,CAAC,IAAI,CAAC;gBAC1C,QAAQ,WAAW,MAAM;gBACzB,OAAO;YACT,GAAG,IAAI,CAAC;gBAAE,WAAW,CAAC;YAAE;YAExB,MAAM,QAAQ;gBACZ,eAAe,SAAS,MAAM;gBAC9B,mBAAmB,SAAS,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,QAAQ,EAAE;gBACjE,mBAAmB,SAAS,MAAM,CAAC,CAAC,IAAM,EAAE,WAAW,EAAE,MAAM;gBAC/D,cAAc,SACX,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,EACrB,MAAM,CAAC,CAAC,KAAK,GAAG,GAAG;oBAClB,OAAO,IAAI,MAAM,GAAG,IAAI,MAAM,CAAC,EAAE,KAAK,IAAI,CAAC,IAAI,IAAI,MAAM,GAAG;gBAC9D,GAAG;gBACL,iBAAiB,QAAQ,CAAC,EAAE,EAAE;gBAC9B,cAAc,4IAAiB,CAAC,GAAG,CAAC,CAAC;oBACnC,MAAM,WAAW,2IAAgB,CAAC,iBAAiB,CACjD,UACA,QAAQ,EAAE;oBAEZ,MAAM,kBAAkB,SAAS,MAAM,CACrC,CAAC,IAAM,EAAE,SAAS,KAAK,QAAQ,EAAE;oBAEnC,MAAM,mBAAmB,IAAI,IAC3B,gBAAgB,MAAM,CAAC,CAAC,IAAM,EAAE,WAAW,EAAE,GAAG,CAAC,CAAC,IAAM,EAAE,QAAQ,GAClE,IAAI;oBAEN,OAAO;wBACL,WAAW,QAAQ,EAAE;wBACrB,aAAa,QAAQ,IAAI;wBACzB;wBACA;wBACA,cAAc,QAAQ,YAAY;wBAClC,aAAa,eAAe,CAAC,EAAE,EAAE;oBACnC;gBACF;YACF;YAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE;YAAM;QACnC;QAEA,IAAI,SAAS,YAAY;YACvB,qCAAqC;YACrC,MAAM,iBAAiB;gBACrB;gBACA;gBACA;aACD;YACD,MAAM,WACJ,2IAAgB,CAAC,wBAAwB,CAAC;YAE5C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE;YAAS;QACtC;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACtE;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,aAAa,MAAM,IAAA,iIAAgB,EAAC;QAC1C,IAAI,CAAC,WAAW,aAAa,EAAE;YAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,GACtE;QAEF,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,YAAY,CAAC,UAAU;YAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OACE;YACJ,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,iDAAiD;QACjD,MAAM,SAAS,2IAAgB,CAAC,aAAa,CAAC,WAAW;QACzD,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,IAAA,sHAAS;QAEf,MAAM,UAAU,IAAI,sIAAe,CAAC;YAClC,QAAQ,WAAW,MAAM;YACzB;YACA;YACA;YACA,WAAW,IAAI;YACf,aAAa,IAAI;YACjB;YACA,OAAO,SAAS;YAChB,OAAO,SAAS;YAChB,YAAY,cAAc;QAC5B;QAEA,MAAM,QAAQ,IAAI;QAElB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;gBACP,IAAI,QAAQ,GAAG;gBACf,WAAW,QAAQ,SAAS;gBAC5B,UAAU,QAAQ,QAAQ;gBAC1B,UAAU,QAAQ,QAAQ;gBAC1B,OAAO,QAAQ,KAAK;gBACpB,aAAa,QAAQ,WAAW;YAClC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACtE;AACF","debugId":null}}]
}