{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/app/auth/verifyotpform/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport Link from 'next/link';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { Key, ArrowLeft, HeartPulse } from 'lucide-react';\n\nexport default function VerifyOTPPage() {\n    const router = useRouter();\n    const searchParams = useSearchParams();\n    const email = searchParams.get('email') || '';\n\n    const [otp, setOtp] = useState(['', '', '', '', '', '']);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState('');\n    const [resendTimer, setResendTimer] = useState(60);\n    const inputRefs = useRef<(HTMLInputElement | null)[]>([]);\n\n    // Countdown timer for resend\n    useEffect(() => {\n        if (resendTimer > 0) {\n            const timer = setTimeout(() => setResendTimer(resendTimer - 1), 1000);\n            return () => clearTimeout(timer);\n        }\n    }, [resendTimer]);\n\n    const handleChange = (index: number, value: string) => {\n        if (value.length > 1) return; // Only allow single digit\n\n        const newOtp = [...otp];\n        newOtp[index] = value;\n        setOtp(newOtp);\n        setError('');\n\n        // Auto-focus next input\n        if (value && index < 5) {\n            inputRefs.current[index + 1]?.focus();\n        }\n    };\n\n    const handleKeyDown = (index: number, e: React.KeyboardEvent) => {\n        if (e.key === 'Backspace' && !otp[index] && index > 0) {\n            inputRefs.current[index - 1]?.focus();\n        }\n    };\n\n    const handlePaste = (e: React.ClipboardEvent) => {\n        e.preventDefault();\n        const pastedData = e.clipboardData.getData('text').slice(0, 6);\n        const newOtp = pastedData.split('');\n        setOtp([...newOtp, ...Array(6 - newOtp.length).fill('')]);\n\n        // Focus the last filled input\n        const lastIndex = Math.min(newOtp.length - 1, 5);\n        inputRefs.current[lastIndex]?.focus();\n    };\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        const otpCode = otp.join('');\n\n        if (otpCode.length !== 6) {\n            setError('Veuillez entrer le code complet √† 6 chiffres');\n            return;\n        }\n\n        setLoading(true);\n        setError('');\n\n        try {\n            console.log('üîç V√©rification OTP:', otpCode, 'pour', email);\n\n            const response = await fetch('/api/auth/verify-otp', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({\n                    email,\n                    otp: otpCode\n                }),\n            });\n\n            const data = await response.json();\n            console.log('üìä R√©ponse API:', data);\n\n            if (!response.ok) {\n                throw new Error(data.error || 'Code incorrect');\n            }\n\n            // Redirection vers reset password avec le token\n            if (data.resetToken) {\n                console.log('‚úÖ OTP valid√©, redirection...');\n                router.push(`/auth/resetpasswordform?token=${data.resetToken}&email=${encodeURIComponent(email)}`);\n            } else {\n                throw new Error('Token de r√©initialisation manquant');\n            }\n        } catch (err: any) {\n            console.error('‚ùå Erreur v√©rification OTP:', err);\n            setError(err.message || 'Code incorrect. Veuillez r√©essayer.');\n            setOtp(['', '', '', '', '', '']);\n            inputRefs.current[0]?.focus();\n            setLoading(false);\n        }\n    };\n\n    const handleResend = async () => {\n        if (resendTimer === 0) {\n            try {\n                console.log('üîÑ Renvoi du code OTP...');\n\n                const response = await fetch('/api/auth/forgot-password', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({ email }),\n                });\n\n                const data = await response.json();\n\n                if (response.ok) {\n                    setResendTimer(60);\n                    setError('');\n                    console.log('‚úÖ Code renvoy√© avec succ√®s');\n\n                    // En d√©veloppement, afficher l'OTP\n                    if (data.otp) {\n                        console.log('üìß Nouveau OTP:', data.otp);\n                    }\n                } else {\n                    setError('Erreur lors du renvoi du code');\n                }\n            } catch (err) {\n                console.error('‚ùå Erreur renvoi OTP:', err);\n                setError('Erreur lors du renvoi du code');\n            }\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#F5F5DC] via-[#FFB8C2]/30 to-[#FF9A3D]/20 px-4 py-12\">\n            <div className=\"w-full max-w-md\">\n                <div className=\"bg-white p-8 rounded-xl shadow-lg\">\n                    {/* Back Button */}\n                    <Link\n                        href=\"/auth/forgotpasswordform\"\n                        className=\"inline-flex items-center text-sm text-gray-600 hover:text-[#FF9A3D] mb-6 transition-colors\"\n                    >\n                        <ArrowLeft size={16} className=\"mr-2\" />\n                        Retour\n                    </Link>\n\n                    <div className=\"text-center mb-6\">\n                        <Link href=\"/\" className=\"inline-flex items-center justify-center mb-4\">\n                            <div className=\"bg-gradient-to-r from-[#FFB8C2] to-[#FF9A3D] rounded-full p-3\">\n                                <HeartPulse size={32} className=\"text-white\" />\n                            </div>\n                        </Link>\n                        <h1 className=\"text-2xl font-bold text-gray-800 mb-2\">\n                            V√©rification du code\n                        </h1>\n                        <p className=\"text-gray-600\">\n                            Entrez le code √† 6 chiffres envoy√© √†\n                        </p>\n                        {email && (\n                            <p className=\"font-medium text-[#FF9A3D] mt-1\">{email}</p>\n                        )}\n                    </div>\n\n                    <form onSubmit={handleSubmit} className=\"space-y-6\">\n                        {/* OTP Input */}\n                        <div>\n                            <div className=\"flex justify-center gap-2 mb-2\">\n                                {otp.map((digit, index) => (\n                                    <input\n                                        key={index}\n                                        ref={(el) => {\n                                            inputRefs.current[index] = el;\n                                        }}\n                                        type=\"text\"\n                                        inputMode=\"numeric\"\n                                        maxLength={1}\n                                        value={digit}\n                                        onChange={(e) => handleChange(index, e.target.value)}\n                                        onKeyDown={(e) => handleKeyDown(index, e)}\n                                        onPaste={index === 0 ? handlePaste : undefined}\n                                        className={`w-12 h-14 text-center text-xl font-semibold border-2 rounded-lg focus:outline-none focus:ring-2 transition-all ${error\n                                            ? 'border-red-300 focus:border-red-500 focus:ring-red-500'\n                                            : 'border-gray-300 focus:border-[#FFB8C2] focus:ring-[#FFB8C2]'\n                                            }`}\n                                        autoFocus={index === 0}\n                                    />\n                                ))}\n                            </div>\n                            {error && (\n                                <p className=\"text-sm text-red-500 text-center mt-2\">{error}</p>\n                            )}\n                        </div>\n\n                        {/* Submit Button */}\n                        <button\n                            type=\"submit\"\n                            disabled={loading || otp.join('').length !== 6}\n                            className={`w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-[#FFB8C2] to-[#FF9A3D] hover:from-[#FF9A3D] hover:to-[#FFB8C2] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FFB8C2] transition-all ${loading || otp.join('').length !== 6\n                                ? 'opacity-70 cursor-not-allowed'\n                                : ''\n                                }`}\n                        >\n                            {loading ? (\n                                <svg\n                                    className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\"\n                                    xmlns=\"http://www.w3.org/2000/svg\"\n                                    fill=\"none\"\n                                    viewBox=\"0 0 24 24\"\n                                >\n                                    <circle\n                                        className=\"opacity-25\"\n                                        cx=\"12\"\n                                        cy=\"12\"\n                                        r=\"10\"\n                                        stroke=\"currentColor\"\n                                        strokeWidth=\"4\"\n                                    ></circle>\n                                    <path\n                                        className=\"opacity-75\"\n                                        fill=\"currentColor\"\n                                        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                                    ></path>\n                                </svg>\n                            ) : (\n                                'V√©rifier le code'\n                            )}\n                        </button>\n                    </form>\n\n                    {/* Resend Code */}\n                    <div className=\"mt-6 text-center\">\n                        <p className=\"text-sm text-gray-600\">\n                            Vous n&apos;avez pas re√ßu le code ?{' '}\n                            {resendTimer > 0 ? (\n                                <span className=\"text-gray-400\">\n                                    Renvoyer dans {resendTimer}s\n                                </span>\n                            ) : (\n                                <button\n                                    onClick={handleResend}\n                                    className=\"font-medium text-[#FF9A3D] hover:text-[#FFB8C2] transition-colors\"\n                                >\n                                    Renvoyer le code\n                                </button>\n                            )}\n                        </p>\n                    </div>\n\n                    {/* Help Text */}\n                    <p className=\"mt-4 text-center text-xs text-gray-500\">\n                        V√©rifiez vos spams si vous ne trouvez pas l&apos;email\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AALA;;;;;;AAOe,SAAS;IACpB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,eAAe,IAAA,qJAAe;IACpC,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY;IAE3C,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAC;QAAC;QAAI;QAAI;QAAI;QAAI;QAAI;KAAG;IACvD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,YAAY,IAAA,+MAAM,EAA8B,EAAE;IAExD,6BAA6B;IAC7B,IAAA,kNAAS,EAAC;QACN,IAAI,cAAc,GAAG;YACjB,MAAM,QAAQ,WAAW,IAAM,eAAe,cAAc,IAAI;YAChE,OAAO,IAAM,aAAa;QAC9B;IACJ,GAAG;QAAC;KAAY;IAEhB,MAAM,eAAe,CAAC,OAAe;QACjC,IAAI,MAAM,MAAM,GAAG,GAAG,QAAQ,0BAA0B;QAExD,MAAM,SAAS;eAAI;SAAI;QACvB,MAAM,CAAC,MAAM,GAAG;QAChB,OAAO;QACP,SAAS;QAET,wBAAwB;QACxB,IAAI,SAAS,QAAQ,GAAG;YACpB,UAAU,OAAO,CAAC,QAAQ,EAAE,EAAE;QAClC;IACJ;IAEA,MAAM,gBAAgB,CAAC,OAAe;QAClC,IAAI,EAAE,GAAG,KAAK,eAAe,CAAC,GAAG,CAAC,MAAM,IAAI,QAAQ,GAAG;YACnD,UAAU,OAAO,CAAC,QAAQ,EAAE,EAAE;QAClC;IACJ;IAEA,MAAM,cAAc,CAAC;QACjB,EAAE,cAAc;QAChB,MAAM,aAAa,EAAE,aAAa,CAAC,OAAO,CAAC,QAAQ,KAAK,CAAC,GAAG;QAC5D,MAAM,SAAS,WAAW,KAAK,CAAC;QAChC,OAAO;eAAI;eAAW,MAAM,IAAI,OAAO,MAAM,EAAE,IAAI,CAAC;SAAI;QAExD,8BAA8B;QAC9B,MAAM,YAAY,KAAK,GAAG,CAAC,OAAO,MAAM,GAAG,GAAG;QAC9C,UAAU,OAAO,CAAC,UAAU,EAAE;IAClC;IAEA,MAAM,eAAe,OAAO;QACxB,EAAE,cAAc;QAChB,MAAM,UAAU,IAAI,IAAI,CAAC;QAEzB,IAAI,QAAQ,MAAM,KAAK,GAAG;YACtB,SAAS;YACT;QACJ;QAEA,WAAW;QACX,SAAS;QAET,IAAI;YACA,QAAQ,GAAG,CAAC,wBAAwB,SAAS,QAAQ;YAErD,MAAM,WAAW,MAAM,MAAM,wBAAwB;gBACjD,QAAQ;gBACR,SAAS;oBACL,gBAAgB;gBACpB;gBACA,MAAM,KAAK,SAAS,CAAC;oBACjB;oBACA,KAAK;gBACT;YACJ;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,GAAG,CAAC,mBAAmB;YAE/B,IAAI,CAAC,SAAS,EAAE,EAAE;gBACd,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAClC;YAEA,gDAAgD;YAChD,IAAI,KAAK,UAAU,EAAE;gBACjB,QAAQ,GAAG,CAAC;gBACZ,OAAO,IAAI,CAAC,CAAC,8BAA8B,EAAE,KAAK,UAAU,CAAC,OAAO,EAAE,mBAAmB,QAAQ;YACrG,OAAO;gBACH,MAAM,IAAI,MAAM;YACpB;QACJ,EAAE,OAAO,KAAU;YACf,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,SAAS,IAAI,OAAO,IAAI;YACxB,OAAO;gBAAC;gBAAI;gBAAI;gBAAI;gBAAI;gBAAI;aAAG;YAC/B,UAAU,OAAO,CAAC,EAAE,EAAE;YACtB,WAAW;QACf;IACJ;IAEA,MAAM,eAAe;QACjB,IAAI,gBAAgB,GAAG;YACnB,IAAI;gBACA,QAAQ,GAAG,CAAC;gBAEZ,MAAM,WAAW,MAAM,MAAM,6BAA6B;oBACtD,QAAQ;oBACR,SAAS;wBACL,gBAAgB;oBACpB;oBACA,MAAM,KAAK,SAAS,CAAC;wBAAE;oBAAM;gBACjC;gBAEA,MAAM,OAAO,MAAM,SAAS,IAAI;gBAEhC,IAAI,SAAS,EAAE,EAAE;oBACb,eAAe;oBACf,SAAS;oBACT,QAAQ,GAAG,CAAC;oBAEZ,mCAAmC;oBACnC,IAAI,KAAK,GAAG,EAAE;wBACV,QAAQ,GAAG,CAAC,mBAAmB,KAAK,GAAG;oBAC3C;gBACJ,OAAO;oBACH,SAAS;gBACb;YACJ,EAAE,OAAO,KAAK;gBACV,QAAQ,KAAK,CAAC,wBAAwB;gBACtC,SAAS;YACb;QACJ;IACJ;IAEA,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;kCAEX,8OAAC,uKAAI;wBACD,MAAK;wBACL,WAAU;;0CAEV,8OAAC,6NAAS;gCAAC,MAAM;gCAAI,WAAU;;;;;;4BAAS;;;;;;;kCAI5C,8OAAC;wBAAI,WAAU;;0CACX,8OAAC,uKAAI;gCAAC,MAAK;gCAAI,WAAU;0CACrB,cAAA,8OAAC;oCAAI,WAAU;8CACX,cAAA,8OAAC,gOAAU;wCAAC,MAAM;wCAAI,WAAU;;;;;;;;;;;;;;;;0CAGxC,8OAAC;gCAAG,WAAU;0CAAwC;;;;;;0CAGtD,8OAAC;gCAAE,WAAU;0CAAgB;;;;;;4BAG5B,uBACG,8OAAC;gCAAE,WAAU;0CAAmC;;;;;;;;;;;;kCAIxD,8OAAC;wBAAK,UAAU;wBAAc,WAAU;;0CAEpC,8OAAC;;kDACG,8OAAC;wCAAI,WAAU;kDACV,IAAI,GAAG,CAAC,CAAC,OAAO,sBACb,8OAAC;gDAEG,KAAK,CAAC;oDACF,UAAU,OAAO,CAAC,MAAM,GAAG;gDAC/B;gDACA,MAAK;gDACL,WAAU;gDACV,WAAW;gDACX,OAAO;gDACP,UAAU,CAAC,IAAM,aAAa,OAAO,EAAE,MAAM,CAAC,KAAK;gDACnD,WAAW,CAAC,IAAM,cAAc,OAAO;gDACvC,SAAS,UAAU,IAAI,cAAc;gDACrC,WAAW,CAAC,+GAA+G,EAAE,QACvH,2DACA,+DACA;gDACN,WAAW,UAAU;+CAfhB;;;;;;;;;;oCAmBhB,uBACG,8OAAC;wCAAE,WAAU;kDAAyC;;;;;;;;;;;;0CAK9D,8OAAC;gCACG,MAAK;gCACL,UAAU,WAAW,IAAI,IAAI,CAAC,IAAI,MAAM,KAAK;gCAC7C,WAAW,CAAC,gSAAgS,EAAE,WAAW,IAAI,IAAI,CAAC,IAAI,MAAM,KAAK,IAC3U,kCACA,IACA;0CAEL,wBACG,8OAAC;oCACG,WAAU;oCACV,OAAM;oCACN,MAAK;oCACL,SAAQ;;sDAER,8OAAC;4CACG,WAAU;4CACV,IAAG;4CACH,IAAG;4CACH,GAAE;4CACF,QAAO;4CACP,aAAY;;;;;;sDAEhB,8OAAC;4CACG,WAAU;4CACV,MAAK;4CACL,GAAE;;;;;;;;;;;2CAIV;;;;;;;;;;;;kCAMZ,8OAAC;wBAAI,WAAU;kCACX,cAAA,8OAAC;4BAAE,WAAU;;gCAAwB;gCACG;gCACnC,cAAc,kBACX,8OAAC;oCAAK,WAAU;;wCAAgB;wCACb;wCAAY;;;;;;yDAG/B,8OAAC;oCACG,SAAS;oCACT,WAAU;8CACb;;;;;;;;;;;;;;;;;kCAQb,8OAAC;wBAAE,WAAU;kCAAyC;;;;;;;;;;;;;;;;;;;;;;AAO1E","debugId":null}}]
}