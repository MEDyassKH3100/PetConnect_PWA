{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/lib/db.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI =\n  process.env.MONGODB_URI || \"mongodb://localhost:27017/petcareverse\";\n\nif (!MONGODB_URI) {\n  throw new Error(\n    \"Please define the MONGODB_URI environment variable inside .env.local\"\n  );\n}\n\nlet cached = (global as any).mongoose;\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null };\n}\n\nasync function connectDB() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log(\"Connexion à la base de données réussie\");\n      return mongoose;\n    });\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cACJ,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE7B;;AAMA,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IACA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QACA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/models/User.ts"],"sourcesContent":["import mongoose, { Document, Schema } from \"mongoose\";\nimport bcrypt from \"bcryptjs\";\nimport connectDB from \"@/lib/db\";\n\nexport interface IUser extends Document {\n  _id: mongoose.Types.ObjectId;\n  firstName: string;\n  lastName: string;\n  email: string;\n  password: string;\n  phone?: string;\n  address?: string;\n  avatar?: string;\n  role: \"user\" | \"admin\" | \"vet\";\n  isVerified: boolean;\n  otp?: string;\n  otpExpires?: Date;\n  resetPasswordToken?: string;\n  resetPasswordExpires?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n  comparePassword(candidatePassword: string): Promise<boolean>;\n}\n\nconst UserSchema = new Schema<IUser>(\n  {\n    firstName: {\n      type: String,\n      required: [true, \"Le prénom est obligatoire\"],\n      trim: true,\n      maxlength: [50, \"Le prénom ne peut pas dépasser 50 caractères\"],\n    },\n    lastName: {\n      type: String,\n      required: [true, \"Le nom est obligatoire\"],\n      trim: true,\n      maxlength: [50, \"Le nom ne peut pas dépasser 50 caractères\"],\n    },\n    email: {\n      type: String,\n      required: [true, \"L'email est obligatoire\"],\n      unique: true,\n      lowercase: true,\n      match: [\n        /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\n        \"Veuillez entrer un email valide\",\n      ],\n    },\n    password: {\n      type: String,\n      required: [true, \"Le mot de passe est obligatoire\"],\n      minlength: [6, \"Le mot de passe doit contenir au moins 6 caractères\"],\n      select: false,\n    },\n    phone: {\n      type: String,\n      maxlength: [20, \"Le téléphone ne peut pas dépasser 20 caractères\"],\n    },\n    address: {\n      type: String,\n      maxlength: [200, \"L'adresse ne peut pas dépasser 200 caractères\"],\n    },\n    avatar: {\n      type: String,\n    },\n    role: {\n      type: String,\n      enum: [\"user\", \"admin\", \"vet\"],\n      default: \"user\",\n    },\n    isVerified: {\n      type: Boolean,\n      default: false,\n    },\n    otp: {\n      type: String,\n      select: false,\n    },\n    otpExpires: {\n      type: Date,\n      select: false,\n    },\n    resetPasswordToken: {\n      type: String,\n      select: false,\n    },\n    resetPasswordExpires: {\n      type: Date,\n      select: false,\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Hacher le mot de passe avant de sauvegarder\nUserSchema.pre(\"save\", async function (next) {\n  if (!this.isModified(\"password\")) return next();\n\n  try {\n    const salt = await bcrypt.genSalt(10);\n    this.password = await bcrypt.hash(this.password, salt);\n    next();\n  } catch (error: any) {\n    next(error);\n  }\n});\n\n// Méthode pour comparer les mots de passe\nUserSchema.methods.comparePassword = async function (\n  candidatePassword: string\n): Promise<boolean> {\n  return bcrypt.compare(candidatePassword, this.password);\n};\n\nexport class UserService {\n  static async register(userData: {\n    firstName: string;\n    lastName: string;\n    email: string;\n    password: string;\n  }): Promise<IUser> {\n    await connectDB(); // Assurer la connexion\n\n    // Créer le modèle après la connexion\n    const User =\n      mongoose.models.User || mongoose.model<IUser>(\"User\", UserSchema);\n\n    const existingUser = await User.findOne({ email: userData.email });\n    if (existingUser) throw new Error(\"Cet email est déjà utilisé\");\n\n    const user = new User(userData);\n    await user.save();\n    return user;\n  }\n}\n\nlet User: mongoose.Model<IUser>;\ntry {\n  User = mongoose.models.User as mongoose.Model<IUser>;\n} catch {\n  User = mongoose.model<IUser>(\"User\", UserSchema);\n}\n\nexport default User;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAsBA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,WAAW;QACT,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,MAAM;QACN,WAAW;YAAC;YAAI;SAA+C;IACjE;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAyB;QAC1C,MAAM;QACN,WAAW;YAAC;YAAI;SAA4C;IAC9D;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAA0B;QAC3C,QAAQ;QACR,WAAW;QACX,OAAO;YACL;YACA;SACD;IACH;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAkC;QACnD,WAAW;YAAC;YAAG;SAAsD;QACrE,QAAQ;IACV;IACA,OAAO;QACL,MAAM;QACN,WAAW;YAAC;YAAI;SAAkD;IACpE;IACA,SAAS;QACP,MAAM;QACN,WAAW;YAAC;YAAK;SAAgD;IACnE;IACA,QAAQ;QACN,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAQ;YAAS;SAAM;QAC9B,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,KAAK;QACH,MAAM;QACN,QAAQ;IACV;IACA,YAAY;QACV,MAAM;QACN,QAAQ;IACV;IACA,oBAAoB;QAClB,MAAM;QACN,QAAQ;IACV;IACA,sBAAsB;QACpB,MAAM;QACN,QAAQ;IACV;AACF,GACA;IACE,YAAY;AACd;AAGF,8CAA8C;AAC9C,WAAW,GAAG,CAAC,QAAQ,eAAgB,IAAI;IACzC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO;IAEzC,IAAI;QACF,MAAM,OAAO,MAAM,uLAAM,CAAC,OAAO,CAAC;QAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,uLAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QACjD;IACF,EAAE,OAAO,OAAY;QACnB,KAAK;IACP;AACF;AAEA,0CAA0C;AAC1C,WAAW,OAAO,CAAC,eAAe,GAAG,eACnC,iBAAyB;IAEzB,OAAO,uLAAM,CAAC,OAAO,CAAC,mBAAmB,IAAI,CAAC,QAAQ;AACxD;AAEO,MAAM;IACX,aAAa,SAAS,QAKrB,EAAkB;QACjB,MAAM,IAAA,+JAAS,KAAI,uBAAuB;QAE1C,qCAAqC;QACrC,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;QAExD,MAAM,eAAe,MAAM,KAAK,OAAO,CAAC;YAAE,OAAO,SAAS,KAAK;QAAC;QAChE,IAAI,cAAc,MAAM,IAAI,MAAM;QAElC,MAAM,OAAO,IAAI,KAAK;QACtB,MAAM,KAAK,IAAI;QACf,OAAO;IACT;AACF;AAEA,IAAI;AACJ,IAAI;IACF,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI;AAC7B,EAAE,OAAM;IACN,OAAO,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;AACvC;uCAEe","debugId":null}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///Users/med_yassine_khlaf/Documents/GitHub/PetConnect_PWA/app/api/auth/register/route.ts"],"sourcesContent":["import { UserService } from \"@/models/User\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { firstName, lastName, email, password } = body;\n\n    // Validation basique\n    if (!firstName || !lastName || !email || !password) {\n      return NextResponse.json(\n        { error: \"Tous les champs sont requis\" },\n        { status: 400 }\n      );\n    }\n\n    // Appeler le service\n    const user = await UserService.register({\n      firstName,\n      lastName,\n      email,\n      password,\n    });\n\n    // Succès\n    return NextResponse.json(\n      { message: \"Inscription réussie\", user },\n      { status: 201 }\n    );\n  } catch (error: any) {\n    console.error(\"Erreur lors de l'inscription :\", error);\n    return NextResponse.json(\n      { error: error.message || \"Erreur serveur\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAEjD,qBAAqB;QACrB,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU;YAClD,OAAO,yLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,OAAO,MAAM,wKAAW,CAAC,QAAQ,CAAC;YACtC;YACA;YACA;YACA;QACF;QAEA,SAAS;QACT,OAAO,yLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAuB;QAAK,GACvC;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,yLAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAiB,GAC3C;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}