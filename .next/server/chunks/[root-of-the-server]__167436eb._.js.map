{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///D:/vscode%20Projects/PetConnect_yassine/lib/db.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI =\r\n  process.env.MONGODB_URI || \"mongodb://localhost:27017/petcareverse\";\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    \"Please define the MONGODB_URI environment variable inside .env.local\"\r\n  );\r\n}\r\n\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function connectDB() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      console.log(\"Connexion à la base de données réussie\");\r\n      return mongoose;\r\n    });\r\n  }\r\n  cached.conn = await cached.promise;\r\n  return cached.conn;\r\n}\r\n\r\nexport default connectDB;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cACJ,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE7B;;AAMA,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IACA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QACA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///D:/vscode%20Projects/PetConnect_yassine/models/User.ts"],"sourcesContent":["import mongoose, { Document, Schema } from \"mongoose\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport connectDB from \"@/lib/db\";\r\n\r\nexport interface IUser extends Document {\r\n  _id: mongoose.Types.ObjectId;\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  password: string;\r\n  phone?: string;\r\n  address?: string;\r\n  avatar?: string;\r\n  role: \"user\" | \"admin\" | \"vet\";\r\n  isVerified: boolean;\r\n  otp?: string;\r\n  otpExpires?: Date;\r\n  resetPasswordToken?: string;\r\n  resetPasswordExpires?: Date;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  comparePassword(candidatePassword: string): Promise<boolean>;\r\n}\r\n\r\nconst UserSchema = new Schema<IUser>(\r\n  {\r\n    firstName: { type: String, required: true, trim: true, maxlength: 50 },\r\n    lastName: { type: String, required: true, trim: true, maxlength: 50 },\r\n    email: {\r\n      type: String,\r\n      required: true,\r\n      unique: true,\r\n      lowercase: true,\r\n      match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, \"Email invalide\"],\r\n    },\r\n    password: { type: String, required: true, minlength: 6, select: false },\r\n    phone: { type: String, maxlength: 20 },\r\n    address: { type: String, maxlength: 200 },\r\n    avatar: { type: String },\r\n    role: { type: String, enum: [\"user\", \"admin\", \"vet\"], default: \"user\" },\r\n    isVerified: { type: Boolean, default: false },\r\n    otp: { type: String, select: false },\r\n    otpExpires: { type: Date, select: false },\r\n    resetPasswordToken: { type: String, select: false },\r\n    resetPasswordExpires: { type: Date, select: false },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\n// Hash password before saving\r\nUserSchema.pre(\"save\", async function (next) {\r\n  if (!this.isModified(\"password\")) return next();\r\n  const salt = await bcrypt.genSalt(10);\r\n  this.password = await bcrypt.hash(this.password, salt);\r\n  next();\r\n});\r\n\r\n// Compare passwords\r\nUserSchema.methods.comparePassword = async function (candidatePassword: string): Promise<boolean> {\r\n  return bcrypt.compare(candidatePassword, this.password);\r\n};\r\n\r\nconst User: mongoose.Model<IUser> = mongoose.models.User || mongoose.model<IUser>(\"User\", UserSchema);\r\n\r\n\r\nexport class UserService {\r\n  static async register(userData: { firstName: string; lastName: string; email: string; password: string }): Promise<IUser> {\r\n    await connectDB();\r\n    const existingUser = await User.findOne({ email: userData.email });\r\n    if (existingUser) throw new Error(\"Cet email est déjà utilisé\");\r\n    const user = new User(userData);\r\n    await user.save();\r\n    return user;\r\n  }\r\n\r\n  static async login(credentials: { email: string; password: string }): Promise<IUser | null> {\r\n    await connectDB();\r\n    const user = await User.findOne({ email: credentials.email }).select(\"+password\");\r\n    if (!user) return null;\r\n    const isMatch = await user.comparePassword(credentials.password);\r\n    if (!isMatch) return null;\r\n    return user;\r\n  }\r\n}\r\n\r\nexport default User;\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAsBA,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,MAAM;QAAM,WAAW;IAAG;IACrE,UAAU;QAAE,MAAM;QAAQ,UAAU;QAAM,MAAM;QAAM,WAAW;IAAG;IACpE,OAAO;QACL,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,OAAO;YAAC;YAAiD;SAAiB;IAC5E;IACA,UAAU;QAAE,MAAM;QAAQ,UAAU;QAAM,WAAW;QAAG,QAAQ;IAAM;IACtE,OAAO;QAAE,MAAM;QAAQ,WAAW;IAAG;IACrC,SAAS;QAAE,MAAM;QAAQ,WAAW;IAAI;IACxC,QAAQ;QAAE,MAAM;IAAO;IACvB,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAQ;YAAS;SAAM;QAAE,SAAS;IAAO;IACtE,YAAY;QAAE,MAAM;QAAS,SAAS;IAAM;IAC5C,KAAK;QAAE,MAAM;QAAQ,QAAQ;IAAM;IACnC,YAAY;QAAE,MAAM;QAAM,QAAQ;IAAM;IACxC,oBAAoB;QAAE,MAAM;QAAQ,QAAQ;IAAM;IAClD,sBAAsB;QAAE,MAAM;QAAM,QAAQ;IAAM;AACpD,GACA;IAAE,YAAY;AAAK;AAGrB,8BAA8B;AAC9B,WAAW,GAAG,CAAC,QAAQ,eAAgB,IAAI;IACzC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO;IACzC,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;IAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,8IAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;IACjD;AACF;AAEA,oBAAoB;AACpB,WAAW,OAAO,CAAC,eAAe,GAAG,eAAgB,iBAAyB;IAC5E,OAAO,8IAAM,CAAC,OAAO,CAAC,mBAAmB,IAAI,CAAC,QAAQ;AACxD;AAEA,MAAM,OAA8B,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;AAGnF,MAAM;IACX,aAAa,SAAS,QAAkF,EAAkB;QACxH,MAAM,IAAA,sHAAS;QACf,MAAM,eAAe,MAAM,KAAK,OAAO,CAAC;YAAE,OAAO,SAAS,KAAK;QAAC;QAChE,IAAI,cAAc,MAAM,IAAI,MAAM;QAClC,MAAM,OAAO,IAAI,KAAK;QACtB,MAAM,KAAK,IAAI;QACf,OAAO;IACT;IAEA,aAAa,MAAM,WAAgD,EAAyB;QAC1F,MAAM,IAAA,sHAAS;QACf,MAAM,OAAO,MAAM,KAAK,OAAO,CAAC;YAAE,OAAO,YAAY,KAAK;QAAC,GAAG,MAAM,CAAC;QACrE,IAAI,CAAC,MAAM,OAAO;QAClB,MAAM,UAAU,MAAM,KAAK,eAAe,CAAC,YAAY,QAAQ;QAC/D,IAAI,CAAC,SAAS,OAAO;QACrB,OAAO;IACT;AACF;uCAEe","debugId":null}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///D:/vscode%20Projects/PetConnect_yassine/app/api/auth/register/route.ts"],"sourcesContent":["import { UserService } from \"@/models/User\";\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { firstName, lastName, email, password } = body;\r\n\r\n    // Validation basique\r\n    if (!firstName || !lastName || !email || !password) {\r\n      return NextResponse.json(\r\n        { error: \"Tous les champs sont requis\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Appeler le service\r\n    const user = await UserService.register({\r\n      firstName,\r\n      lastName,\r\n      email,\r\n      password,\r\n    });\r\n\r\n    // Succès\r\n    return NextResponse.json(\r\n      { message: \"Inscription réussie\", user },\r\n      { status: 201 }\r\n    );\r\n  } catch (error: any) {\r\n    console.error(\"Erreur lors de l'inscription :\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"Erreur serveur\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAEjD,qBAAqB;QACrB,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU;YAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,OAAO,MAAM,+HAAW,CAAC,QAAQ,CAAC;YACtC;YACA;YACA;YACA;QACF;QAEA,SAAS;QACT,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAuB;QAAK,GACvC;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAiB,GAC3C;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}